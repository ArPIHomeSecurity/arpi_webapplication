<div *ngIf="syren != null" class="container">
  
  <form [formGroup]="syrenForm" (ngSubmit)="onSubmit()" class="syren-form">

    <mat-accordion class="full-width">
      <mat-expansion-panel expanded="true">
        <mat-expansion-panel-header>
          <mat-panel-title i18n="@@syren sources">Syren</mat-panel-title>
        </mat-expansion-panel-header>
        
          <div class="silent">
            <h4 i18n="@@syren volume">Syren volume</h4>
            <mat-radio-group class="silent" formControlName="silentAlert">
              <mat-radio-button value="undefined">
                <span i18n="@@syren silent undefined">Normal</span>
              </mat-radio-button>
              <mat-radio-button value="silent">
                <span i18n="@@syren silent">Silent alert</span>
              </mat-radio-button>
              <mat-radio-button value="loud">
                <span i18n="@@syren silent loud">Loud alarm (forced)</span>
              </mat-radio-button>
            </mat-radio-group>
          </div>

          <mat-divider></mat-divider>

          <h4 i18n="@@syren timing">Syren timing</h4>
          <div class="timing row">
            <mat-form-field class="full-width">
              <input matInput type="number" min="0" i18n-placeholder="@@syren delay" placeholder="Delay" formControlName="delay" required/>
              <mat-hint i18n="@@syren delay hint">Delay the syren in seconds</mat-hint>
            </mat-form-field>
            
            <mat-form-field class="full-width">
              <input matInput type="number" min="0" i18n-placeholder="@@syren stop" placeholder="Stop time" formControlName="stopTime" required/>
              <mat-hint i18n="@@syren stop hint">Stop the syren in seconds</mat-hint>
            </mat-form-field>
          </div>

          <mat-divider></mat-divider>
          
          <h4 i18n="@@syren sensitivity alerty">Alert sensitivity</h4>
          <div class="sensitivity row">
            <mat-checkbox formControlName="sensitivity" color="primary" i18n="@@syren sensitivity" (change)="onSensitivityChanged($event)">Custom sensitivity</mat-checkbox>

            <mat-form-field [ngClass]="{'block': !syrenForm.value.sensitivity}">
              <mat-label i18n="@@alert monitor period">Monitoring period [s]</mat-label>
              <input matInput formControlName="monitorPeriod" type="number" min="1" required>
            </mat-form-field>
            
            <mat-form-field [ngClass]="{'block': !syrenForm.value.sensitivity}">
              <mat-label i18n="@@alert monitor threshold">Monitoring threshold [%]</mat-label>
              <input matInput formControlName="monitorThreshold" type="number" min="0" max="100" required>
            </mat-form-field>
          </div>

      </mat-expansion-panel>
      
    </mat-accordion>
    
    <div class="actions">
      <button mat-raised-button type="submit" color="primary" [disabled]="syrenForm.invalid || monitoringState != monitoringStates.READY"
        i18n="@@save button">Save</button>
      <button mat-raised-button type="button" color="primary" [disabled]="syrenForm.invalid || monitoringState != monitoringStates.READY || testInProgress"
        (click)="onTestSyren()">
        <span i18n="@@syren test">Test</span>
        <mat-progress-spinner *ngIf="testInProgress" class="test-spinner" diameter="15" color="primary" mode="indeterminate"></mat-progress-spinner>
      </button>
      </div>
  </form>
</div>

<ng-template #snackbarTemplate>
  <span i18n="@@failed save">Failed to save!</span>
</ng-template>
