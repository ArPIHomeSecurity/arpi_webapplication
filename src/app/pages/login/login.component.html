<div class="container">
  <!-- register device -->
  @if (canRegister()) {
    <mat-card class="register container-item">
      <mat-card-header>
        <mat-card-title-group>
          <mat-card-title i18n="Register device">Register device</mat-card-title>
        </mat-card-title-group>
      </mat-card-header>
      <mat-card-content>
        <form name="form" [formGroup]="registerForm">
          <mat-form-field>
            <mat-label i18n="@@register registration code">Registration code</mat-label>
            <input
              matInput
              #registration_code_field
              [type]="hide ? 'password' : 'text'"
              [formControl]="registerCode"
              autocomplete="off"
              required
              autofocus
              />
            <mat-icon matSuffix (click)="hide = !hide">
              {{ hide ? 'visibility_off' : 'visibility' }}
            </mat-icon>
          </mat-form-field>
          <div class="form-group actions">
            <button
              mat-raised-button
              (click)="register()"
              [disabled]="loading || !registerForm.valid"
              color="primary"
              >
              <span i18n="Register button">Register</span>
              @if (loading) {
                <mat-icon>
                  <mat-spinner diameter="18" />
                </mat-icon>
              }
            </button>
          </div>
          @if (error) {
            <div class="alert alert-danger">{{ error }}</div>
          }
        </form>
      </mat-card-content>
    </mat-card>
  }

  <!-- login manually/biometric -->
  @if (canLoginManually()) {
    <mat-card class="login container-item">
      <mat-card-header>
        <mat-card-title-group>
          <mat-card-title>
            <span i18n="Login title">Login</span>
            &nbsp;
            @if (userName) {
              <span>({{ userName }})</span>
            }
          </mat-card-title>
        </mat-card-title-group>
      </mat-card-header>
      <mat-card-content>
        <form name="form" [formGroup]="loginForm">
          <mat-form-field>
            <mat-label i18n="@@login access code">Access code</mat-label>
            <input
              matInput
              #access_code_field
              type="text"
              [formControl]="accessCode"
              [ngClass]="{ password: hide }"
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="10"
              autocomplete="off"
              digitOnly
              required
              autofocus
              />
            <mat-icon matSuffix (click)="hide = !hide">
              {{ hide ? 'visibility_off' : 'visibility' }}
            </mat-icon>
          </mat-form-field>
          <div class="form-group actions">
            <button
              mat-raised-button
              type="submit"
              (click)="loginManually()"
              [disabled]="loading || !loginForm.valid"
              color="primary"
              >
              <span i18n="Login button">Login</span>
              @if (loading) {
                <mat-icon>
                  <mat-spinner diameter="18" />
                </mat-icon>
              }
            </button>
            @if (canStartLoginWithBiometric()) {
              <button
                mat-raised-button
                (click)="biometricLogin()"
                [disabled]="loading"
                color="primary"
                >
                <span i18n="@@login biometric login">Biometric login</span>
              </button>
            }
          </div>
          @if (error) {
            <div class="alert alert-danger">
              @switch (error) {
                @case ('invalid origin') {
                  <div i18n="@@login host not allowed">
            Host not allowed!
          </div>
                }
                @case ('missing device token') {
                  <div i18n="@@login missing device token">
            Missing device token! Register your device!
          </div>
                }
                @case ('invalid device token') {
                  <div i18n="@@login invalid device token">
            Invalid device token! Update your device registration!
          </div>
                }
                @case ('expired registration code') {
                  <div i18n="@@login expired registration code">
            Expired device registration code!
          </div>
                }
                @case ('invalid user id') {
                  <div i18n="@@login invalid user id">
            Invalid user id! Update your device registration!
          </div>
                }
                @case ('invalid registration code') {
                  <div i18n="@@login invalid registration code">
            Invalid registration code!
          </div>
                }
                @case ('invalid access code') {
                  <div i18n="@@login invalid access code">
            Invalid access code!
          </div>
                }
                @case ('no connection') {
                  <div i18n="@@login no connedtion">
            No connection to the security system!
          </div>
                }
                @default {
                  <div i18n="@@login error">Something went wrong!?</div>
                }
              }
            </div>
          }
        </form>
      </mat-card-content>
    </mat-card>
  }

  <!-- biometric login question -->
  @if (canAskBiometric()) {
    <mat-card class="biometric container-item">
      <mat-card-header>
        <mat-icon mat-card-avatar>fingerprint</mat-icon>
        <mat-card-title i18n="@@biometric description">
        Do you want to use biometric login?
      </mat-card-title>
        <mat-card-subtitle i18n="@@biometric question">
        You can use biometric login to access the security system.
      </mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-raised-button (click)="allowBiometric(true)" color="primary">
          <span i18n="@@biometric yes">Yes</span>
        </button>
        <button mat-raised-button (click)="allowBiometric(false)" color="warn">
          <span i18n="@@biometric no">No</span>
        </button>
      </mat-card-actions>
    </mat-card>
  }

  <!-- biometric login -->
  @if (canLoginWithBiometric()) {
    <mat-card class="biometric container-item">
      <mat-card-header>
        <mat-spinner mat-card-avatar diameter="32"></mat-spinner>
        <mat-card-title>Login with biometric</mat-card-title>
        <mat-card-subtitle i18n="@@biometric login description">
        Use biometric login to access the security system.
      </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content></mat-card-content>
    </mat-card>
  }
</div>
