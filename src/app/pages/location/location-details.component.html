<div class="container">
  @if (location) {
    <mat-card class="container-item zone-form">
      <mat-card-content>
        <form [formGroup]="locationForm" (ngSubmit)="onSubmit()">
          <div class="column">
            <mat-form-field>
              <mat-label i18n="@@location name">Name</mat-label>
              <input
                matInput
                type="text"
                class="form-control"
                maxlength="16"
                formControlName="name"
                />
            </mat-form-field>
            <div class="row">
              <mat-form-field class="domain" floatLabel="always">
                <mat-label i18n="@@location primary domain">Primary Domain</mat-label>
                <span matTextPrefix>https://</span>
                <input
                  matInput
                  type="text"
                  autocapitalize="off"
                  class="form-control"
                  name="primaryDomain"
                  formControlName="primaryDomain"
                  (change)="onFieldChange($event)"
                  />
                @if (showApiLink && testResult?.primary === false) {
                  <mat-hint>
                    <a
                      href="https://{{ location.primaryDomain }}:{{ location.primaryPort }}/api/version"
                      target="_blank"
                      >
                      <span i18n="@@location check" class="no-wrap">Check API version and certificate</span>
                      <mat-icon>open_in_new</mat-icon>
                    </a>
                  </mat-hint>
                }
              </mat-form-field>
              <mat-form-field class="port">
                <mat-label i18n="@@location port">Port</mat-label>
                <input
                  matInput
                  type="number"
                  class="form-control"
                  name="primaryPort"
                  formControlName="primaryPort"
                  (change)="onFieldChange($event)"
                  />
              </mat-form-field>
              @if (testResult !== null) {
                <div class="status">
                  @if (testResult.primary === true) {
                    <mat-icon class="icon-accessible">
                      check_circle
                    </mat-icon>
                  }
                  @if (testResult.primary === false) {
                    <mat-icon class="icon-inaccessible">
                      error
                    </mat-icon>
                  }
                  @if (testResult.primary === null) {
                    <mat-spinner diameter="16" />
                  }
                </div>
              }
            </div>
            <div class="row">
              <mat-form-field class="domain" floatLabel="always">
                <mat-label i18n="@@location secondary domain">Secondary Domain</mat-label>
                <span matTextPrefix>https://</span>
                <input
                  matInput
                  type="text"
                  autocapitalize="off"
                  class="form-control"
                  name="secondaryDomain"
                  formControlName="secondaryDomain"
                  (change)="onFieldChange($event)"
                  />
                @if (showApiLink && testResult?.secondary === false) {
                  <mat-hint>
                    <a
                  href="https://{{ location.secondaryDomain }}:{{
                    location.secondaryPort
                  }}/api/version"
                      target="_blank"
                      >
                      <span i18n="@@location check" class="no-wrap">Check API version and certificate</span>
                      <mat-icon>open_in_new</mat-icon>
                    </a>
                  </mat-hint>
                }
              </mat-form-field>
              <mat-form-field class="port">
                <mat-label i18n="@@location port">Port</mat-label>
                <input
                  matInput
                  type="number"
                  class="form-control"
                  name="secondaryPort"
                  formControlName="secondaryPort"
                  (change)="onFieldChange($event)"
                  />
              </mat-form-field>
              @if (testResult !== null) {
                <div class="status">
                  @if (testResult.secondary === true) {
                    <mat-icon class="icon-accessible">
                      check_circle
                    </mat-icon>
                  }
                  @if (testResult.secondary === false) {
                    <mat-icon class="icon-inaccessible">
                      error
                    </mat-icon>
                  }
                  @if (testResult.secondary === undefined) {
                    <mat-icon class="icon-na">not_interested</mat-icon>
                  }
                  @if (testResult.secondary === null) {
                    <mat-spinner diameter="16" />
                  }
                </div>
              }
            </div>
          </div>
        </form>
      </mat-card-content>
      @if (location.id) {
        <mat-divider></mat-divider>
        <mat-card-content class="details">
          <dl>
            @if (location.id) {
              <dt>ID</dt>
            }
            @if (location.id) {
              <dd>{{ location.id }}</dd>
            }
            @if (version) {
              <dt i18n="@@location version">Version</dt>
            }
            @if (version) {
              <dd>{{ version.version_tag }}</dd>
            }
            @if (boardVersion) {
              <dt i18n="@@location board version">Board version</dt>
            }
            @if (boardVersion) {
              <dd>{{ boardVersion }}</dd>
            }
          </dl>
          @if (location.id != null) {
            <div class="register">
              <mat-divider></mat-divider>
              @if (isRegistered() === true) {
                <div>
                  <mat-icon class="icon-accessible">check_circle</mat-icon>
                  <div class="text" i18n="@@location device registered">Device registered</div>
                </div>
              }
              @if (isRegistered() === false) {
                <div>
                  <mat-icon class="icon-inaccessible">error</mat-icon>
                  <div class="text" i18n="@@location device not registered">Device NOT registered</div>
                </div>
              }
            </div>
          }
          @if (alreadyExists() && newLocation) {
            <app-message
              type="warning"
              [message]="ALREADY_EXISTS"
            ></app-message>
          }
        </mat-card-content>
      }
      <mat-divider></mat-divider>
      <mat-card-actions align="end">
        <button
          mat-icon-button
          color="primary"
          (click)="executeLocationTest()"
          [disabled]="locationForm.invalid"
          >
          <mat-icon>search</mat-icon>
        </button>
        <button mat-icon-button color="primary" (click)="onSubmit()" [disabled]="cantSave()">
          <mat-icon>save</mat-icon>
        </button>
        @if (!newLocation && isMultiLocation) {
          <button
            mat-icon-button
            color="warn"
            type="button"
            (click)="openDeleteDialog()"
            [disabled]="selectedLocationId === location.id || location.id == null"
            >
            <mat-icon>delete</mat-icon>
          </button>
        }
        @if (!firstLocation) {
          <button
            mat-icon-button
            color="accent"
            type="button"
            (click)="onCancel()"
            >
            <mat-icon>cancel</mat-icon>
          </button>
        }
      </mat-card-actions>
    </mat-card>
  }

  @if (location == null) {
    <div class="container-item">
      <h1 i18n="@@location not found">The location was not found!</h1>
    </div>
  }
</div>
