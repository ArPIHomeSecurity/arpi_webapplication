<mat-card class="user-card container-item">
  <mat-card-header>
    <mat-icon
      mat-card-avatar
      *ngIf="user.role === roleTypes.ADMIN"
      matListIcon
      mat-card-avatar
      class="avatar"
    >
      person
    </mat-icon>
    <mat-icon *ngIf="user.role === roleTypes.USER" matListIcon mat-card-avatar class="avatar">
      person_outline
    </mat-icon>
    <mat-card-title>{{ user.name }}</mat-card-title>
    <mat-card-subtitle *ngIf="user.role === roleTypes.ADMIN" i18n="@@user type administrator">
      Administrator
    </mat-card-subtitle>
    <mat-card-subtitle *ngIf="user.role === roleTypes.USER" i18n="@@user type user">
      User
    </mat-card-subtitle>
  </mat-card-header>

  <mat-spinner *ngIf="loading" color="primary" diameter="40"></mat-spinner>

  <span *ngIf="!loading">
    <mat-divider></mat-divider>

    <!-- Cards -->
    <mat-card-content>
      <mat-card-title i18n="@@user cards">Cards</mat-card-title>
      <mat-list role="list" *ngFor="let card of cards">
        <mat-checkbox
          color="primary"
          [checked]="card.enabled"
          [disabled]="!canManageCards || disabled"
          (change)="toggleCardEnabled(card.id)"
        >
          <mat-icon [className]="card.enabled ? 'card-enabled' : 'card-disabled'">
            credit_card
          </mat-icon>
          <span [className]="!card.enabled ? 'card-description-disabled' : ''">
            {{ card.description }}
          </span>
        </mat-checkbox>
        <button
          mat-icon-button
          color="warn"
          [disabled]="!canManageCards || disabled"
          (click)="openDeleteCardDialog(card.id)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-list>
      <mat-card-subtitle *ngIf="cards.length === 0 && !registeringCard" i18n="@@user no cards">
        No cards registered
      </mat-card-subtitle>
      <mat-progress-spinner
        *ngIf="registeringCard"
        color="primary"
        mode="indeterminate"
        diameter="20"
      ></mat-progress-spinner>
    </mat-card-content>

    <mat-divider></mat-divider>

    <!-- Registration code -->
    <mat-card-content>
      <mat-card-title i18n="@@user device registration code">
        Device registration code
      </mat-card-title>
      <div class="registration" *ngIf="user.hasRegistrationCode">
        <mat-icon class="entry">key</mat-icon>
        <span i18n="@@user registration">Expires on:</span>
        <span *ngIf="user.registrationExpiry">{{ user.registrationExpiry }}</span>
        <span *ngIf="!user.registrationExpiry" i18n="@@user expiry never">never</span>
        <button
          mat-icon-button
          color="warn"
          [disabled]="!canManageRegistration || disabled"
          (click)="openDeleteRegistrationCodeDialog()"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <mat-card-subtitle *ngIf="!user.hasRegistrationCode" i18n="@@user no registration code">
        No registration code
      </mat-card-subtitle>
    </mat-card-content>

    <mat-divider *ngIf="user.role === roleTypes.ADMIN"></mat-divider>

    <!-- SSH key -->
    <mat-card-content *ngIf="user.role === roleTypes.ADMIN">
      <mat-card-title i18n="@@user ssh key">SSH key</mat-card-title>
      <div class="ssh" *ngIf="hasSshKey">
        <mat-icon class="entry">terminal</mat-icon>
        <button
          mat-icon-button
          color="warn"
          [disabled]="!canManageSshKeys || disabled"
          (click)="openDeleteSshKeyDialog()"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <mat-card-subtitle *ngIf="!hasSshKey" i18n="@@user no ssh key">No SSH key</mat-card-subtitle>
    </mat-card-content>

    <mat-divider *ngIf="user.comment"></mat-divider>

    <!-- Comment -->
    <mat-card-content *ngIf="user.comment">
      <p>{{ user.comment }}</p>
    </mat-card-content>

    <mat-divider *ngIf="biometricAvailable"></mat-divider>

    <!-- Biometric login -->
    <mat-card-content *ngIf="biometricAvailable">
      <mat-card-title i18n="@@user biometric login">Biometric login</mat-card-title>
      <div *ngIf="biometricEnabled()" class="biometric">
        <mat-icon class="entry">fingerprint</mat-icon>
        <span i18n="@@user biometric enabled">Enabled</span>
      </div>
      <div *ngIf="!biometricEnabled()" class="biometric">
        <mat-icon class="entry">fingerprint</mat-icon>
        <span i18n="@@user biometric disabled">Disabled</span>
      </div>
    </mat-card-content>
  </span>

  <mat-divider></mat-divider>

  <mat-card-actions>
    <button mat-icon-button color="primary" [disabled]="disabled" (click)="navigateToUserEdit()">
      <mat-icon>mode_edit</mat-icon>
    </button>
    <button
      mat-icon-button
      color="warn"
      [disabled]="!canManageUser || disabled"
      (click)="openDeleteUserDialog()"
    >
      <mat-icon>delete</mat-icon>
    </button>

    <button mat-icon-button [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
    <mat-menu #menu="matMenu">
      <button
        mat-menu-item
        color="primary"
        [disabled]="!canManageRegistration || user.hasRegistrationCode || disabled"
        i18n="@@user register device button"
        (click)="openDeviceRegistrationDialog()"
      >
        Device registration
      </button>
      <button
        *ngIf="canManageCards"
        mat-menu-item
        color="primary"
        [disabled]="disabled"
        (click)="onClickRegisterCard()"
        i18n="@@user register card button"
      >
        Register card
      </button>
      <button
        *ngIf="user.role === roleTypes.ADMIN"
        mat-menu-item
        color="primary"
        [disabled]="!canManageSshKeys || hasSshKey || disabled"
        (click)="openSshKeySetupDialog()"
        i18n="@@user generate ssk key"
      >
        Setup SSH key
      </button>

      <!-- Biometric login -->
      <div *ngIf="biometricAvailable">
        <mat-divider></mat-divider>
        <button
          *ngIf="!biometricEnabled()"
          mat-menu-item
          color="primary"
          [disabled]="disabled"
          (click)="enableBiometricLogin()"
        >
          <span i18n="@@user enable biometric">Enable biometric login</span>
        </button>
        <button
          *ngIf="biometricEnabled()"
          mat-menu-item
          color="warn"
          [disabled]="disabled"
          (click)="disableBiometricLogin()"
        >
          <span i18n="@@user disable biometric">Disable biometric login</span>
        </button>
      </div>
    </mat-menu>
  </mat-card-actions>
</mat-card>
