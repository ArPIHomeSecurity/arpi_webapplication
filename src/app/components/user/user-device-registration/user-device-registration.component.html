<h1 mat-dialog-title i18n="@@user device registration">Device registration</h1>
<div mat-dialog-content>
  <form [formGroup]="registrationForm">
    <label i18n="@@user select expiry">Select expiry</label>
    <mat-radio-group formControlName="mode" (change)="onModeChanged($event)" class="expiry-mode">
      @for (mode of modes; track mode) {
        <mat-radio-button [value]="mode.value">
          {{ mode.name }}
        </mat-radio-button>
      }
    </mat-radio-group>

    <mat-form-field class="half-width">
      <input matInput formControlName="counter" type="number" class="counter" />
    </mat-form-field>

    <mat-form-field class="half-width">
      <mat-select formControlName="unit">
        @for (unit of units; track unit) {
          <mat-option [value]="unit.value" required>
            {{ unit.viewValue }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </form>
</div>

@if (registrationCode) {
  <div class="registration">
    <span i18n="@@user device registration code">Device registration code</span>
    <div class="code">
      {{ registrationCode }}
      <!-- https://stackoverflow.com/a/58115714 -->
      @if (registrationCode) {
        <button
          mat-icon-button
          onclick="this.blur()"
          (click)="copyText(registrationCode)"
          >
          <mat-icon>file_copy</mat-icon>
        </button>
      }
    </div>
  </div>
}

<div mat-dialog-actions>
  <button
    mat-raised-button
    [disabled]="!registrationForm.valid || registrationCode"
    (click)="getNewCode()"
    tabindex="2"
    color="primary"
    i18n="@@user get new code"
    >
    Get new code
  </button>

  <button mat-button (click)="onClickClose()" tabindex="-1" i18n="@@close button">Close</button>
</div>
