<div *ngIf="syren != null">
  <form [formGroup]="syrenForm" (ngSubmit)="onSubmit()"
      ngClass.gt-xs="syren-form" ngClass.xs="syren-form-xs" fxLayout="column" fxLayoutGap="20px">

    <mat-accordion class="full-width">
      <mat-expansion-panel expanded="true">
        <mat-expansion-panel-header>
          <mat-panel-title i18n="@@syren sources">Syren</mat-panel-title>
        </mat-expansion-panel-header>
        
          <div class="silent">
            <h4 i18n="@@syren silent">Silent alarm</h4>
            <mat-checkbox formControlName="silent" i18n="@@syren silent hint">Do not use the syren in case of an alarm</mat-checkbox>
          </div>

          <mat-divider></mat-divider>

          <h4 i18n="@@syren timing">Syren timing</h4>
          <div class="timing" fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="15">
            <mat-form-field class="full-width">
              <input matInput type="number" min="0" i18n-placeholder="@@syren delay" placeholder="Delay" formControlName="delay" required/>
              <mat-hint i18n="@@syren delay hint">Delay the syren in seconds</mat-hint>
            </mat-form-field>
            
            <mat-form-field class="full-width">
              <input matInput type="number" min="0" i18n-placeholder="@@syren stop" placeholder="Stop time" formControlName="stopTime" required/>
              <mat-hint i18n="@@syren stop hint">Stop the syren in seconds</mat-hint>
            </mat-form-field>
          </div>

          <mat-divider></mat-divider>
          
          <h4 i18n="@@syren sensitivity">Alert sensitivity</h4>
          <div class="sensitivity" fxLayout="row" fxLayoutGap="20">
            <mat-checkbox formControlName="sensitivity" color="primary" i18n="@@sensor sensitivity" (change)="onSensitivityChanged($event)">Custom sensitivity</mat-checkbox>

            <mat-form-field [fxHide]="!syrenForm.value.sensitivity">
              <mat-label i18n="@@alert monitor period">Monitoring period[s]</mat-label>
              <input matInput formControlName="monitorPeriod" type="number" min="1" required>
            </mat-form-field>
            
            <mat-form-field [fxHide]="!syrenForm.value.sensitivity">
              <mat-label i18n="@@alert monitor threshold">Monitoring threshold [%]</mat-label>
              <input matInput formControlName="monitorThreshold" type="number" min="0" max="100" required>
            </mat-form-field>
          </div>

      </mat-expansion-panel>
      
    </mat-accordion>
    
    <div class="actions">
      <button mat-raised-button type="submit" color="primary" [disabled]="syrenForm.invalid || monitoringState != monitoringStates.READY"
        i18n="@@save button">Save</button>
      <button mat-raised-button type="button" color="primary" [disabled]="syrenForm.invalid || monitoringState != monitoringStates.READY || testInProgress"
        (click)="onTestSyren()">
        <span i18n="@@syren test">Test</span>
        <mat-progress-spinner *ngIf="testInProgress" class="test-spinner" diameter="15" color="primary" mode="indeterminate"></mat-progress-spinner>
      </button>
      </div>
  </form>
</div>

<ng-template #snackbarTemplate>
  <span i18n="@@failed save">Failed to save!</span>
</ng-template>
